// Generated by CoffeeScript 1.7.1
var BindScrollToBottom, DidGetArticlesData, GetArticles;

$(document).on("deviceready", function() {
  $(".actionbar .page-title").text("专栏文章");
  CenterTitle();
  BindScrollToBottom();
  window.nickname = unescape(getQueryString("nickname"));
  GetArticles();
});

BindScrollToBottom = function() {
  $(window).unbind("scroll").on("scroll", function(event) {
    if ($(document).scrollTop() + $(window).height() >= $(document).height() - 10) {
      if (!window.stopFetch) {
        GetArticles();
      }
    }
  });
};

GetArticles = function() {
  var _ref;
  RequestAjax("GET", "/mj/people/" + window.nickname + "/articles?numPerPage=10&pageNum=" + (((_ref = window.currentPageNum) != null ? _ref : 0) + 1), {}, DidGetArticlesData, null, false);
};

DidGetArticlesData = function(data, rawData) {
  var article, articleHTML, articles, htmlString, _i, _len, _ref;
  if (window.currentPageNum != null) {
    window.currentPageNum++;
  } else {
    window.currentPageNum = 1;
  }
  if ($(".articleItem").length <= 0) {
    articles = template("People/Articles");
    htmlString = articles(data.Data);
    if (htmlString.search("Template Error") < 0) {
      $(".container").replaceWith(htmlString);
    } else {
      ShowLoadingError();
      return;
    }
  } else {
    htmlString = "";
    _ref = data.Data.Articles;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      article = _ref[_i];
      articleHTML = template("public/ArticleItem");
      htmlString += articleHTML(article);
    }
    $(".container").append(htmlString);
  }
  if (window.currentPageNum >= parseInt(data.Data.PageSum)) {
    window.stopFetch = true;
  }
};
