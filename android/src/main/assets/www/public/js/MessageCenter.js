// Generated by CoffeeScript 1.7.1
var DidGetDirectMessageData, DidGetResponseData, DidGetUpdateData, GetDirectMessages, GetResponses, GetUpdate, PositionUnreadIndicator;

$(document).on("deviceready", function() {
  var actionbar, main;
  actionbar = template("public/ActionBar");
  $("body").html(actionbar());
  $(".actionbar .channel").addClass("hide");
  $(".actionbar .slide-menu").addClass("hide");
  $(".actionbar .page-title").text("消息中心");
  $(".actionbar").children(".center").css("left", ($(window).width() - $(".actionbar .center").children(".page-title").width()) / 2);
  main = template("MessageCenter/Index");
  $(".spinner").replaceWith(main());
  $(".tab").each(function() {
    $(this).unbind("click").on("click", function(event) {
      if (!$(this).hasClass("active")) {
        $(".active").removeClass("active");
        $(this).addClass("active");
        switch ($(this).data("target")) {
          case "directmessage":
            GetDirectMessages();
            break;
          case "response":
            GetResponses();
            break;
          case "update":
            GetUpdate();
        }
      }
    });
  });
  GetDirectMessages();
});

GetDirectMessages = function() {
  RequestAjax("GET", "/mj/people/conversations", {}, DidGetDirectMessageData, null);
};

GetResponses = function() {
  RequestAjax("GET", "/mj/msgcenter/response", {}, DidGetResponseData, null);
};

GetUpdate = function() {
  RequestAjax("GET", "/mj/msgcenter/update", {}, DidGetUpdateData, null);
};

DidGetDirectMessageData = function(data, rawData) {
  var directmessage;
  directmessage = template("MessageCenter/DirectMessage");
  $(".payload").html(directmessage(data));
  PositionUnreadIndicator();
};

DidGetResponseData = function(data, rawData) {
  var responses;
  responses = template("MessageCenter/Response");
  $(".payload").html(responses(data));
};

DidGetUpdateData = function(data, rawData) {
  var update;
  update = template("MessageCenter/Update");
  $(".payload").html(update(data));
};

PositionUnreadIndicator = function() {
  $(".unread-indicator").each(function(index) {
    var offsetTop;
    offsetTop = ($(this).closest(".msg").find("img").height() - $(this).height()) / 2;
    $(this).css("top", "" + offsetTop + "px");
  });
};
